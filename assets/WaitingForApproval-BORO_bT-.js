import{c as A,d as E,u as V,a as L,r as p,o as W,w as F,b as c,e as M,f as t,g as Y,h as r,i as z,j as b,t as S,k as G,v as H,l as C,n as J,m as I,p as q,q as j,s as K,x as Q,y as X,z as i,_ as Z}from"./index-BT3l2VS0.js";const x=A(),o={socket:null,cafeId:null,token:null,reconnectTimer:null},ee="wss://iisertvmcafe.work.gd";function te(m,u){return`${ee}/ws/order-control/${m}/?token=${u}`}function P(){o.reconnectTimer!==null&&(clearTimeout(o.reconnectTimer),o.reconnectTimer=null)}function O(m,u){if(!m||!u||o.socket&&o.socket.readyState===WebSocket.OPEN&&o.cafeId===m)return;ae(),o.cafeId=m,o.token=u;const d=new WebSocket(te(m,u));o.socket=d,d.onopen=()=>{P(),x.emit("socket-open",null)},d.onmessage=f=>{try{const n=JSON.parse(f.data);n.type==="staging_update"&&x.emit("staging-update",n),n.type==="payment_update"&&x.emit("payment-update",n)}catch{}},d.onerror=()=>{d.close()},d.onclose=()=>{o.socket=null,x.emit("socket-close",null),!o.reconnectTimer&&o.cafeId&&o.token&&(o.reconnectTimer=setTimeout(()=>{O(o.cafeId,o.token)},3e3))}}function ae(){P(),o.socket&&o.socket.close(),o.socket=null,o.cafeId=null,o.token=null}const se={class:"min-h-screen bg-gradient-to-b from-orange-50 to-white flex items-center justify-center p-4"},oe={key:0,class:"text-center"},re={key:1,class:"card max-w-md w-full"},ne={class:"w-24 h-24 mx-auto mb-6 bg-gradient-to-br from-blue-500 to-indigo-500 rounded-full flex items-center justify-center animate-pulse"},le={key:2,class:"card w-full max-w-md"},ie={class:"w-24 h-24 mx-auto mb-6 bg-gradient-to-br from-emerald-500 to-green-500 rounded-full flex items-center justify-center animate-scale-in"},de={class:"mb-6"},ce={class:"block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2"},me={class:"flex items-center justify-between bg-gradient-to-r from-orange-50 to-amber-50 p-4 rounded-2xl border-2 border-cafe-primary/20"},ue={class:"mb-6"},fe={class:"block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2"},be={class:"mb-6"},ge={class:"block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2"},pe={key:0,class:"relative"},xe={for:"file-upload",class:"flex flex-col items-center justify-center w-full h-40 border-2 border-dashed border-gray-300 rounded-2xl cursor-pointer bg-gray-50 hover:bg-gray-100 transition-all"},ye={key:1,class:"relative"},ve=["src"],we=["disabled"],he={key:3,class:"card max-w-md w-full"},ke={class:"w-24 h-24 mx-auto mb-6 bg-gradient-to-br from-amber-500 to-orange-500 rounded-full flex items-center justify-center animate-pulse"},_e={class:"bg-amber-50 border-2 border-amber-200 rounded-2xl p-4 flex items-start gap-3"},Se={key:4,class:"card max-w-md w-full"},Ce={class:"w-24 h-24 mx-auto mb-6 bg-gradient-to-br from-emerald-500 to-green-500 rounded-full flex items-center justify-center animate-scale-in"},Ie={class:"bg-emerald-50 border-2 border-emerald-200 rounded-2xl p-4 mb-6 flex items-start gap-3"},je={key:5,class:"card max-w-md w-full"},Te={class:"w-24 h-24 mx-auto mb-6 bg-gradient-to-br from-red-500 to-rose-500 rounded-full flex items-center justify-center animate-scale-in"},Pe={class:"bg-red-50 border-2 border-red-200 rounded-2xl p-4 mb-6 flex items-start gap-3"},T="iiservithura@sbi",Oe=E({__name:"WaitingForApproval",setup(m){const u=V(),d=q(),f=String(u.params.stagingId),n=L(),_=p(!0),l=p("pending"),v=p(""),w=p(null),g=p(!1),h=p(null),k=a=>window.alert(a),B=async()=>{try{const a=await j.get(`/orders/staging/${f}/`,{params:{cafe:n.selectedCafeId}});l.value=a.data.status}catch{k("Couldn't load your order")}finally{_.value=!1}},N=()=>{!n.accessToken||!n.selectedCafeId||(O(n.selectedCafeId,n.accessToken),x.on("staging-update",a=>{`${a.order_id}`===f&&(l.value=a.stage)}),x.on("payment-update",a=>{`${a.order_id}`===f&&(l.value=a.payment_status==="verified"?"payment_verified":"payment_submitted")}),K(Number(f),n.accessToken,n.selectedCafeId),Q.on("order-status",a=>{a.status==="payment_verified"&&(l.value="payment_verified",n.setLastStagingId(null)),a.status==="rejected"&&(l.value="rejected",X())}))},R=a=>{const e=a.target?.files?.[0];if(e){w.value=e;const s=new FileReader;s.onload=y=>{h.value=y.target?.result},s.readAsDataURL(e)}},U=()=>{window.confirm("Remove uploaded image?")&&(w.value=null,h.value=null)},$=async()=>{await navigator.clipboard.writeText(T)},D=async()=>{if(!v.value.trim()){k("Please enter transaction ID");return}if(!w.value){k("Please upload payment screenshot");return}g.value=!0;try{const a=new FormData;a.append("transaction_id",v.value),a.append("transaction_image",w.value),await j.post(`/orders/staging/${f}/submit-payment/`,a,{headers:{"Content-Type":"multipart/form-data"}}),l.value="payment_submitted"}catch{k("Payment upload failed. Please try again.")}finally{g.value=!1}};return W(()=>{B(),N()}),F(l,a=>{(a==="payment_verified"||a==="rejected")&&n.setLastStagingId(null)}),(a,e)=>{const s=z("ion-icon");return i(),c("div",se,[_.value?(i(),c("div",oe,[...e[3]||(e[3]=[t("div",{class:"relative w-24 h-24 mx-auto mb-6"},[t("div",{class:"absolute inset-0 rounded-full border-4 border-orange-100"}),t("div",{class:"absolute inset-0 rounded-full border-4 border-t-cafe-primary border-r-transparent border-b-transparent border-l-transparent animate-spin"})],-1),t("p",{class:"text-gray-600 font-medium text-lg"},"Loading your order...",-1)])])):l.value==="pending"?(i(),c("div",re,[t("div",ne,[r(s,{name:"time-outline",class:"text-5xl text-white"})]),e[4]||(e[4]=Y('<h2 class="text-2xl font-bold text-gray-800 mb-3" data-v-5969722b>Checking with Staff</h2><p class="text-gray-600" data-v-5969722b>Your order is being reviewed by our team. This usually takes a minute.</p><div class="mt-6 flex items-center justify-center gap-2" data-v-5969722b><div class="w-2 h-2 bg-cafe-primary rounded-full animate-bounce" style="animation-delay:0ms;" data-v-5969722b></div><div class="w-2 h-2 bg-cafe-primary rounded-full animate-bounce" style="animation-delay:150ms;" data-v-5969722b></div><div class="w-2 h-2 bg-cafe-primary rounded-full animate-bounce" style="animation-delay:300ms;" data-v-5969722b></div></div>',3))])):l.value==="awaiting_payment"?(i(),c("div",le,[t("div",ie,[r(s,{name:"checkmark-circle",class:"text-5xl text-white"})]),e[11]||(e[11]=t("h2",{class:"text-2xl font-bold text-gray-800 mb-2"},"Order Approved! ðŸŽ‰",-1)),e[12]||(e[12]=t("p",{class:"text-gray-600 mb-6"},"Complete the payment to confirm your order",-1)),t("div",de,[t("label",ce,[r(s,{name:"card-outline",class:"text-lg"}),e[5]||(e[5]=b(" UPI ID ",-1))]),t("div",me,[t("span",{class:"font-mono font-semibold text-gray-800"},S(T)),t("button",{onClick:$,class:"px-4 py-2 bg-cafe-primary text-white rounded-xl font-semibold text-sm flex items-center gap-2 hover:bg-cafe-primary/90 active:scale-95 transition-all"},[r(s,{name:"copy-outline"}),e[6]||(e[6]=b(" Copy ",-1))])])]),t("div",ue,[t("label",fe,[r(s,{name:"key-outline",class:"text-lg"}),e[7]||(e[7]=b(" Transaction ID ",-1))]),G(t("input",{"onUpdate:modelValue":e[0]||(e[0]=y=>v.value=y),placeholder:"Enter your transaction/UTR number",class:"w-full px-4 py-4 border-2 border-gray-200 rounded-2xl focus:border-cafe-primary focus:ring-2 focus:ring-cafe-primary/20 transition-all outline-none font-medium"},null,512),[[H,v.value]])]),t("div",be,[t("label",ge,[r(s,{name:"image-outline",class:"text-lg"}),e[8]||(e[8]=b(" Payment Screenshot ",-1))]),h.value?(i(),c("div",ye,[t("img",{src:h.value,class:"w-full h-48 object-cover rounded-2xl border-2 border-emerald-200"},null,8,ve),t("button",{onClick:U,class:"absolute top-2 right-2 w-10 h-10 bg-red-500 text-white rounded-full flex items-center justify-center shadow-lg hover:bg-red-600 active:scale-95 transition-all"},[r(s,{name:"close",class:"text-2xl"})])])):(i(),c("div",pe,[t("input",{type:"file",accept:"image/*",onChange:R,class:"hidden",id:"file-upload"},null,32),t("label",xe,[r(s,{name:"cloud-upload-outline",class:"text-5xl text-gray-400 mb-2"}),e[9]||(e[9]=t("p",{class:"text-sm text-gray-600 font-medium"},"Tap to upload screenshot",-1)),e[10]||(e[10]=t("p",{class:"text-xs text-gray-400 mt-1"},"PNG, JPG up to 10MB",-1))])]))]),t("button",{class:J(["w-full py-4 rounded-2xl font-bold text-white text-lg shadow-lg flex items-center justify-center gap-2 transition-all disabled:opacity-50",g.value?"bg-gray-400":"bg-gradient-to-r from-cafe-primary to-orange-500 hover:shadow-xl active:scale-98"]),disabled:g.value,onClick:D},[g.value?(i(),C(s,{key:0,name:"refresh-outline",class:"text-xl animate-spin"})):(i(),C(s,{key:1,name:"checkmark-circle-outline",class:"text-xl"})),b(" "+S(g.value?"Submitting...":"Submit Payment"),1)],10,we)])):l.value==="payment_submitted"?(i(),c("div",he,[t("div",ke,[r(s,{name:"hourglass-outline",class:"text-5xl text-white"})]),e[14]||(e[14]=t("h2",{class:"text-2xl font-bold text-gray-800 mb-3"},"Verifying Payment",-1)),e[15]||(e[15]=t("p",{class:"text-gray-600 mb-6"},"Our team is verifying your payment. This usually takes 1-2 minutes.",-1)),t("div",_e,[r(s,{name:"information-circle",class:"text-2xl text-amber-600 mt-0.5"}),e[13]||(e[13]=t("p",{class:"text-sm text-amber-800"},"Please keep this screen open while we verify your payment.",-1))]),e[16]||(e[16]=t("div",{class:"mt-6 flex items-center justify-center gap-2"},[t("div",{class:"w-2 h-2 bg-cafe-primary rounded-full animate-bounce",style:{"animation-delay":"0ms"}}),t("div",{class:"w-2 h-2 bg-cafe-primary rounded-full animate-bounce",style:{"animation-delay":"150ms"}}),t("div",{class:"w-2 h-2 bg-cafe-primary rounded-full animate-bounce",style:{"animation-delay":"300ms"}})],-1))])):l.value==="payment_verified"?(i(),c("div",Se,[t("div",Ce,[r(s,{name:"checkmark-done-circle",class:"text-5xl text-white"})]),e[19]||(e[19]=t("h2",{class:"text-2xl font-bold text-gray-800 mb-3"},"Payment Confirmed! âœ¨",-1)),e[20]||(e[20]=t("p",{class:"text-gray-600 mb-6"},"Your order has been confirmed and will be prepared shortly.",-1)),t("div",Ie,[r(s,{name:"checkmark-circle",class:"text-2xl text-emerald-600 mt-0.5"}),e[17]||(e[17]=t("p",{class:"text-sm text-emerald-800"},"You can track your order status in the Active Orders section.",-1))]),t("button",{class:"w-full py-4 bg-gradient-to-r from-cafe-primary to-orange-500 text-white rounded-2xl font-bold text-lg shadow-lg hover:shadow-xl active:scale-98 transition-all flex items-center justify-center gap-2",onClick:e[1]||(e[1]=y=>I(d).replace("/"))},[r(s,{name:"home-outline",class:"text-xl"}),e[18]||(e[18]=b(" Back to Home ",-1))])])):l.value==="rejected"?(i(),c("div",je,[t("div",Te,[r(s,{name:"close-circle",class:"text-5xl text-white"})]),e[23]||(e[23]=t("h2",{class:"text-2xl font-bold text-gray-800 mb-3"},"Order Rejected",-1)),e[24]||(e[24]=t("p",{class:"text-gray-600 mb-6"},"Unfortunately, your order could not be processed at this time.",-1)),t("div",Pe,[r(s,{name:"information-circle",class:"text-2xl text-red-600 mt-0.5"}),e[21]||(e[21]=t("p",{class:"text-sm text-red-800"},"This might be due to item availability or other reasons. Please try ordering again or contact our staff.",-1))]),t("button",{class:"w-full py-4 bg-gradient-to-r from-cafe-primary to-orange-500 text-white rounded-2xl font-bold text-lg shadow-lg hover:shadow-xl active:scale-98 transition-all flex items-center justify-center gap-2",onClick:e[2]||(e[2]=y=>I(d).replace("/"))},[r(s,{name:"home-outline",class:"text-xl"}),e[22]||(e[22]=b(" Back to Home ",-1))])])):M("",!0)])}}}),Ne=Z(Oe,[["__scopeId","data-v-5969722b"]]);export{Ne as default};
